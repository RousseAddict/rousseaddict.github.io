---
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const posts = await Astro.glob('../../content/blog/*.md');
  
  return posts.map((post) => ({
    params: { slug: post.frontmatter.slug },
    props: { post }
  }));
}

const { post } = Astro.props;
const { Content } = post;
const { title, description, pubDate, tags = [] } = post.frontmatter;

const formattedDate = new Date(pubDate).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

// Calculate reading time
function calculateReadingTime(content: string): string {
  const wordsPerMinute = 200;
  const words = content.trim().split(/\s+/).length;
  const minutes = Math.ceil(words / wordsPerMinute);
  return `${minutes} min read`;
}

const readingTime = calculateReadingTime(post.compiledContent());
---

<BaseLayout 
  title={title}
  description={description}
>
  <article>
    <div class="post-header">
      <h1 class="post-title">{title}</h1>
      
      <div class="post-meta">
        <time datetime={new Date(pubDate).toISOString()}>{formattedDate}</time>
        <span>• {readingTime}</span>
      </div>
      
      {tags.length > 0 && (
        <div class="post-tags">
          {tags.map((tag: string) => (
            <a href={`/tags/${tag}`} class="tag">{tag}</a>
          ))}
        </div>
      )}
    </div>
    
    <div class="prose">
      <Content />
    </div>
  </article>
  
  <div style="margin-top: 3rem;">
    <a href="/">← Back to all posts</a>
  </div>
</BaseLayout>